{% extends "base.html" %}
{% block title %}Deposit{% endblock %}

{% block content %}
<div class="flex justify-center">
  <div class="w-full max-w-lg bg-white rounded-2xl shadow-lg p-8 space-y-8">

    {# ────────── Currency chooser ────────── #}
    {% if not address %}
      <h2 class="text-2xl font-semibold text-center">Select currency</h2>

      {% if error %}
        <div class="mb-4 p-3 bg-red-100 text-red-700 rounded">
          {{ error }}
        </div>
      {% endif %}

      <form method="post" class="space-y-6">
        {% csrf_token %}
        {{ form.as_p }}
        <button type="submit"
                class="w-full py-2 bg-blue-600 text-white font-medium rounded-lg hover:bg-blue-700 transition">
          Generate address
        </button>
      </form>

    {# ────────── Address / QR view ────────── #}
    {% else %}
      <h2 class="text-2xl font-semibold text-center">Deposit {{ currency }}</h2>

      <p class="text-center break-all">
        <span class="font-medium">Address:</span><br>
        <code id="addr">{{ address }}</code>
      </p>

      <button onclick="navigator.clipboard.writeText('{{ address }}')
                       .then(()=>this.textContent='Copied!')"
              class="block mx-auto mt-2 text-sm text-blue-600 hover:underline">
        Copy to clipboard
      </button>

      <img src="data:image/png;base64,{{ qr_b64 }}"
           alt="QR code"
           class="mx-auto w-60 h-60 sm:w-72 sm:h-72 rounded shadow-md">

      <a href="{% url 'dashboard_index' %}" class="block text-center text-blue-600 hover:underline">
        ← Back to dashboard
      </a>
    {% endif %}

  </div>
</div>
{% endblock %}
